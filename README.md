# RNA-Seq course University of Bern: RNA-Seq Analysis for Breast Cancer Study
This repository contains the scripts used for the RNA-Seq analysis of breast cancer samples from the study by [Eswaran et al.](https://www.nature.com/articles/srep00264#Sec14). The corresponding FASTQ files for **selected** samples were obtained from the Gene Expression Omnibus (GEO) under accession number [GSE52194](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE52194) and were provided by Dr. Alexander Nater via the IBU cluster.
Full report of this analysis can be found [here](https://github.com/ann4boss/rna_course/blob/main/RNASeq_Report_AnnaBoss.pdf).

## Prerequisites
Ensure the following are available:
- Access to the IBU cluster.
- A Bash environment with SLURM job scheduler.
- Apptainer for containerized tools.
- Local R environment with RStudio and Bioconductor packages.
- Required folder structure:
  - `data/`: Input data, reference genomes, and intermediate files.
  - `analysis/`: Analysis results and output files.
  - `scripts/`: Bash or R scripts.

## Scripts
- `01_copy_fastq_files.sh`: Copies raw FASTQ files.
- `02_QC_fastq.sh`: Runs FastQC on FASTQ files.
- `03_MultiQC.sh`: Aggregates FastQC, FastP, Mapping, FeatureCount.
- `04_clean_reads.sh`: Cleans raw reads using FastP.
- `05_download_genome_and_annotation.sh`: Downloads reference genome and annotation files from [Ensembl](https://www.ensembl.org/Homo_sapiens/Info/Index).
- `06_indexing.sh`: Unzipps reference genome and annotation files and indexes the reference genome with HISAT2.
- `07_mapping.sh`: Maps reads to the reference genome using HISAT2.
- `08_count_read_per_gene.sh`: Counts reads per gene using featureCounts.
- `09_exploratory_data_analysis.R`: Performs differential expression analysis, generates visualizations, and conducts GO enrichment analysis.

## Script Execution Order
### Part 1: Bash Scripts (Run on IBU Cluster)

1. **Copy FASTQ files**  
   `sbatch scripts/01_copy_fastq_files.sh`

2. **Run FastQC**  
   `sbatch scripts/02_QC_fastq.sh`


3. **Clean reads with FastP**  
   `sbatch scripts/04_clean_reads.sh`

4. **Aggregate quality control results with MultiQC (after FastP)**  
   `sbatch scripts/03_multiqc.sh <FILE_EXTENSION> <input_directory_for_fastp> <output_directory_for_multiqc>`

5. **Download reference genome and annotation files**  
   `sbatch scripts/05_download_genome_and_annotation.sh`

6. **Index the reference genome**  
   `sbatch scripts/06_indexing.sh`

7. **Align cleaned reads to the reference genome with HISAT2**  
   `sbatch scripts/07_mapping.sh`

8. **Aggregate mapping statistics with MultiQC (after HISAT2 mapping)**  
   `sbatch scripts/03_multiqc.sh <FILE_EXTENSION> <input_directory_for_mapping> <output_directory_for_multiqc>`

9. **Count reads per gene with featureCounts**  
    `sbatch scripts/08_count_read_per_gene.sh`

10. **Aggregate featureCounts results with MultiQC**  
    `sbatch scripts/03_multiqc.sh <FILE_EXTENSION> <input_directory_for_featurecounts> <output_directory_for_multiqc>`


### Part 2: R Script (Run locally in RStudio)

#### Prerequisites
Before running the R script, ensure the following:

1. Create the same folder structure locally as used on the IBU cluster
    - `data/`: Input data, reference genomes, and intermediate files.
    - `analysis/`: Analysis results and output files.
    - `scripts/`: Bash or R scripts.
2. Download adjusted_gene_counts.txt
    - Obtain the adjusted_gene_counts.txt file generated during the previous steps on the IBU cluster.
    - Save it in the appropriate folder (`/data`) within your local project directory.


Running the R Script:
Ensure all required R packages are installed by running the 09_exploratory_data_analysis.R script. The script will automatically install missing packages.

## Output
The results of the analysis are organized into the following directories:
### On IBU cluster:
- **`analysis/01_fastqc_results/`**:  
  Contains quality control reports generated by FastQC, detailing the quality of raw FASTQ files.

- **`analysis/02_cleaning_results/`**:  
  Stores cleaned FASTQ files, processed with FastP, for downstream analysis.

- **`analysis/03_multiqc_cleaned_vs_raw/`**:  
  Includes MultiQC reports comparing quality metrics of raw and cleaned reads.

- **`analysis/04_mapping_results/`**:  
  Contains aligned BAM files and mapping statistics generated by HISAT2.

- **`analysis/05_multiqc_mapping/`**:  
  Aggregated mapping quality metrics, including alignment statistics, provided by MultiQC.

- **`analysis/06_multiqc_featureCount/`**:  
  Aggregated reports on read counts per gene, generated using MultiQC.

- **`data/04_featureCounts_results/`**:  
  Gene count results in tabular format, suitable for differential expression analysis.

### Locally:

- **`analysis/`**:  
  Final differential expression results and visualizations, including:
  - PCA plots: To assess sample clustering.
  - DESeq2 results.
  - Volcano plots: Highlighting differentially expressed genes.
  - Heatmaps of differently expressed genes.
  - GO enrichment analysis outputs.


## Reproducibility Details
To ensure reproducibility, specific details about data and reference genome/ annotation files downloads are documented below:

### Raw reads copying
- Date of data copying: 07Dec202
- Source directory: /data/courses/rnaseq_course/breastcancer_de/reads/
- Destination directory: data/01_reads_copy/
- Samples copied:
HER21, HER22, HER23, NonTNBC1, NonTNBC2, NonTNBC3, Normal1, Normal2, Normal3, TNBC1, TNBC2, TNBC3

### Reference genome and annotation file download
- Date of download: 12Nov2024
- Source: Ensembl FTP site (release 113)
- Species: Homo sapiens (GRCh38)
- Files downloaded:
    - Reference genome: Homo_sapiens.GRCh38.dna.primary_assembly.fa.gz
    - Annotation file: Homo_sapiens.GRCh38.113.gtf.gz
    - Checksum files: CHECKSUMS_REF_GENOME, CHECKSUMS_ANNOTATION_GENOME
- Checksum verification: Successful for both reference genome and annotation files.

## Contact
For questions or issues related to this repository, please contact:

Anna Boss: [anna.boss@students.unibe.ch](mailto:anna.boss@students.unibe.ch)
